//File: TestO.c 
//Generated by TMC Converter(C)2009-2016
#include "tmc.h"
#include "stdtmc.h"

#include "TestO.globals.h"

// User provided C-code header (must be included in include path):
#include "External_func.h"

// % Lines 1--12:
//function [plants,Fw,ki,kp,kd,polew]=TestO(pars) 

//% Inputs:

//% 			pars(1)= R;

//% 			pars(2) = L;

//% 			pars(3) = Ts;

//% 			pars(4) = Delay;

//% Outputs:

//%   plants = P(j*w)

//%   Fw      =  w [rad/sec]

//%     Ki,kp,kd,polew = arrays of solutions

//% e.g. pars=[ 1,1e-3,5e-6,0  ];

//    PlantModel = struct('R',pars(1),'L',pars(2),'Ts',pars(3),'Delay',pars(4));

void tmcTestO(int nargout, int nargin,tmsMatrix *plants,tmsMatrix *Fw,tmsMatrix *ki,tmsMatrix *kp,tmsMatrix *kd,tmsMatrix *polew
,tmsMatrix *pars) {
tmsMatrix **reg=tmcCreateRegFrame(107);
tmsMatrix *PlantModel=tmcNewMatrix();
tmsMatrix *Ctrl=tmcNewMatrix();
tmsMatrix *n=tmcNewMatrix();
tmsMatrix *kk=tmcNewMatrix();

TRY
TMC_DBG_PUSH_STACK_VAR("TestO",11,
pars,"pars",
plants,"plants",
Fw,"Fw",
ki,"ki",
kp,"kp",
kd,"kd",
polew,"polew",
PlantModel,"PlantModel",
Ctrl,"Ctrl",
n,"n",
kk,"kk");

tmcCreateString(reg[1],"R");

tmcScalar(reg[3],1.000000000000000e+000);
tmcGetByIndex(reg[4],pars,1,reg[3]);
tmcCreateString(reg[5],"L");

tmcScalar(reg[7],2.000000000000000e+000);
tmcGetByIndex(reg[8],pars,1,reg[7]);
tmcCreateString(reg[9],"Ts");

tmcScalar(reg[11],3.000000000000000e+000);
tmcGetByIndex(reg[12],pars,1,reg[11]);
tmcCreateString(reg[13],"Delay");

tmcScalar(reg[15],4.000000000000000e+000);
tmcGetByIndex(reg[16],pars,1,reg[15]);
//CALL function
tmcReallocRegister(reg[17]);
tmcstruct(1,8, reg[17], reg[1], reg[4], reg[5], reg[8], reg[9], reg[12], reg[13], reg[16]
);

tmcAssign(PlantModel,reg[17]);
//statement here,line 12

// % Lines 13--14:
//    

//    [PlantModel,Ctrl] = findcompensator(PlantModel);


//CALL function
tmcReallocRegister(reg[20]);
tmcReallocRegister(reg[21]);
tmcfindcompensator(2,1, reg[20], reg[21], PlantModel);

tmcAssign(PlantModel,reg[20]);

tmcAssign(Ctrl,reg[21]);
//statement here,line 14

// % Lines 15--15:
//    plants=PlantModel.P;


tmcGetByFieldHcode(reg[26],PlantModel,0x00500000);/* P */

tmcAssign(plants,reg[26]);
//statement here,line 15

// % Lines 16--16:
//    Fw     =PlantModel.F*2*pi; 


tmcGetByFieldHcode(reg[30],PlantModel,0x00460000);/* F */
tmcScalar(reg[31],2.000000000000000e+000);
tmcMul(reg[32],reg[30],reg[31]);
//CALL function
tmcReallocRegister(reg[33]);
tmcpi(1,0, reg[33]);
tmcMul(reg[34],reg[32],reg[33]);

tmcAssign(Fw,reg[34]);
//statement here,line 16

// % Lines 17--17:
//    n = length(Ctrl);


//CALL function
tmcReallocRegister(reg[37]);
tmclength(1,1, reg[37], Ctrl);

tmcAssign(n,reg[37]);
//statement here,line 17

// % Lines 18--18:
//    ki  =zeros(1,n);

tmcScalar(reg[39],1.000000000000000e+000);

//CALL function
tmcReallocRegister(reg[41]);
tmczeros(1,2, reg[41], reg[39], n);

tmcAssign(ki,reg[41]);
//statement here,line 18

// % Lines 19--19:
//    kp=zeros(1,n);

tmcScalar(reg[43],1.000000000000000e+000);

//CALL function
tmcReallocRegister(reg[45]);
tmczeros(1,2, reg[45], reg[43], n);

tmcAssign(kp,reg[45]);
//statement here,line 19

// % Lines 20--20:
//    kd=zeros(1,n);

tmcScalar(reg[47],1.000000000000000e+000);

//CALL function
tmcReallocRegister(reg[49]);
tmczeros(1,2, reg[49], reg[47], n);

tmcAssign(kd,reg[49]);
//statement here,line 20

// % Lines 21--21:
//    polew=zeros(1,n);

tmcScalar(reg[51],1.000000000000000e+000);

//CALL function
tmcReallocRegister(reg[53]);
tmczeros(1,2, reg[53], reg[51], n);

tmcAssign(polew,reg[53]);
//statement here,line 21

// % Lines 22--23:
//    for kk=1:n

//        if isfield(Ctrl{kk},'KI'),  ki(kk)=Ctrl{kk}.KI;end;

tmcScalar(reg[55],1.000000000000000e+000);

tmcCreateColonBaseLimit(reg[57],reg[55],n);
tmcForIterInit(reg[58],reg[57],kk);
label_4: ; //FOR begin
if(tmcForIterNext(reg[58],reg[57])) goto label_3; // exit for


tmcGetByIndexCell(reg[61],Ctrl,1,kk);
tmcIsFieldHcode(reg[62],reg[61],0x095e0000);/* KI */
if(tmcIsFalse(reg[62])) goto label_6; // goto to the end of the clause if the expression is false


tmcGetByIndexCell(reg[66],Ctrl,1,kk);
tmcGetByFieldHcode(reg[68],reg[66],0x095e0000);/* KI */


tmcGetRefByIndex(pRefHelper,ki,1,kk);
tmcAssign(pRefHelper,reg[68]);
//statement here,line 23

goto label_5; //branch to end IF
label_6: ; //end IF clause
label_5: ; //end IF
//statement here,line 23

// % Lines 24--24:
//        if isfield(Ctrl{kk},'KP'),  kp(kk)=Ctrl{kk}.KP;end;



tmcGetByIndexCell(reg[73],Ctrl,1,kk);
tmcIsFieldHcode(reg[74],reg[73],0x09650000);/* KP */
if(tmcIsFalse(reg[74])) goto label_8; // goto to the end of the clause if the expression is false


tmcGetByIndexCell(reg[78],Ctrl,1,kk);
tmcGetByFieldHcode(reg[80],reg[78],0x09650000);/* KP */


tmcGetRefByIndex(pRefHelper,kp,1,kk);
tmcAssign(pRefHelper,reg[80]);
//statement here,line 24

goto label_7; //branch to end IF
label_8: ; //end IF clause
label_7: ; //end IF
//statement here,line 24

// % Lines 25--25:
//        if isfield(Ctrl{kk},'KD'),  kd(kk)=Ctrl{kk}.KD;end;



tmcGetByIndexCell(reg[85],Ctrl,1,kk);
tmcIsFieldHcode(reg[86],reg[85],0x09590000);/* KD */
if(tmcIsFalse(reg[86])) goto label_10; // goto to the end of the clause if the expression is false


tmcGetByIndexCell(reg[90],Ctrl,1,kk);
tmcGetByFieldHcode(reg[92],reg[90],0x09590000);/* KD */


tmcGetRefByIndex(pRefHelper,kd,1,kk);
tmcAssign(pRefHelper,reg[92]);
//statement here,line 25

goto label_9; //branch to end IF
label_10: ; //end IF clause
label_9: ; //end IF
//statement here,line 25

// % Lines 26--26:
//        if isfield(Ctrl{kk},'w'),  polew(kk)=Ctrl{kk}.w;end;



tmcGetByIndexCell(reg[97],Ctrl,1,kk);
tmcIsFieldHcode(reg[98],reg[97],0x00770000);/* w */
if(tmcIsFalse(reg[98])) goto label_12; // goto to the end of the clause if the expression is false


tmcGetByIndexCell(reg[102],Ctrl,1,kk);
tmcGetByFieldHcode(reg[104],reg[102],0x00770000);/* w */


tmcGetRefByIndex(pRefHelper,polew,1,kk);
tmcAssign(pRefHelper,reg[104]);
//statement here,line 26

goto label_11; //branch to end IF
label_12: ; //end IF clause
label_11: ; //end IF
//statement here,line 26

// % Lines 27--27:
//    end

label_2: ; //FOR end
goto label_4; //branch to FOR begin
label_3: ; //FOR exit
//statement here,line 27

// % Lines 28--28:
label_1: ; //end Function
FINALLY
tmcFreeLocalVar(kk);
tmcFreeLocalVar(n);
tmcFreeLocalVar(Ctrl);
tmcFreeLocalVar(PlantModel);
tmcFreeRegFrame(reg);

TMC_DBG_POP_STACK_VAR(11);

ENDFINALLY
}

//FUNCTION DEFINITION ENDED
//statement here,line 28

// % Lines 29--29:
